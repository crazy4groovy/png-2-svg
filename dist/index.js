"use strict";const fs=require("fs"),PNGReader=require("png.js"),JPEGReader=require("jpeg-js"),ImageTracer=require("imagetracerjs"),SVGO=require("svgo"),vibrantPalette=require("./color-paint"),dataOptimize=require("./data-optimize"),svgo=new SVGO({plugins:require("./svgo-plugins")}),toSvg=ImageTracer.imagedataToSVG;async function getImgData(e){const t=fs.readFileSync(e);if(e.endsWith("png")){const e=new PNGReader(t),a=await new Promise((t,a)=>{e.parse((e,r)=>{e?a(e):t(r)})});return{height:a.height,width:a.width,data:a.pixels}}return JPEGReader.decode(t)}async function svgThumbnailer(e,{colors:t=4,scale:a=2,vibrant:r=!0,tolerance:i=0,combineLines:o=!1,smooth:s=0,smoothDecimalPlaces:n}={}){const c=await getImgData(e),m=Math.ceil(128/t**2)+1,l={scale:a,ltres:m,qtres:m,pathomit:Math.min(32,4+3*t),colorquantcycles:Math.min(6,t),numberofcolors:t,mincolorratio:r?1e-5:.03};r&&(l.pal=vibrantPalette(c.data,t));const g=await svgo.optimize(toSvg(c,l));if(!(i||o||s))return g;const u={combineLines:o,smooth:s,smoothDecimalPlaces:n,tolerance:i},d=dataOptimize(g.data,u);return{...g,data:d}}module.exports=svgThumbnailer;
