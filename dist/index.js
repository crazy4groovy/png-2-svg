"use strict";const fs=require("fs"),PNGReader=require("png.js"),JPEGReader=require("jpeg-js"),ImageTracer=require("imagetracerjs"),SVGO=require("svgo"),{getPalette:getPalette}=require("./color-thief"),dataOptimize=require("./data-optimize"),svgo=new SVGO({plugins:require("./svgo-plugins")}),toSvg=ImageTracer.imagedataToSVG;async function getImgData(e){const t=fs.readFileSync(e);if(e.endsWith("png")){const e=new PNGReader(t),a=await new Promise((t,a)=>{e.parse((e,i)=>{e?a(e):t(i)})});return{height:a.height,width:a.width,data:a.pixels}}return JPEGReader.decode(t)}async function svgThumbnailer(e,{colors:t=4,scale:a=1,vibrant:i=!0,tolerance:r=0,combineLines:o=!1,decimalPlaces:s=!0,smooth:n=0}={}){const c=await getImgData(e),g=Math.ceil(128/t**2)+1,l={scale:a,ltres:g,qtres:g,pathomit:Math.min(32,4+3*t),colorquantcycles:Math.min(6,t),numberofcolors:t,mincolorratio:i?1e-5:.03};if(i){const{palette:e}=getPalette(c,t);l.pal=e.map(([e,t,a])=>({r:e,g:t,b:a,a:255}))}const m=await svgo.optimize(toSvg(c,l));if(!r&&!o&&s&&!n)return m;const u={combineLines:o,smooth:n,decimalPlaces:s,tolerance:r};return svgo.optimize(dataOptimize(m,u))}module.exports=svgThumbnailer;
