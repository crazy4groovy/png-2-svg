"use strict";const fs=require("fs"),PNGReader=require("png.js"),JPEGReader=require("jpeg-js"),ImageTracer=require("imagetracerjs"),SVGO=require("svgo"),dataOptimize=require("./data-optimize"),svgo=new SVGO({plugins:require("./svgo-plugins")}),toSvg=ImageTracer.imagedataToSVG;async function getImgData(e){const a=fs.readFileSync(e);if(e.endsWith("png")){const e=new PNGReader(a),t=await new Promise((a,t)=>{e.parse((e,r)=>{e?t(e):a(r)})});return{height:t.height,width:t.width,data:t.pixels}}return JPEGReader.decode(a)}async function svgThumbnailer(e,{colors:a=4,scale:t=2,tolerance:r=.2,combineLines:o,smooth:s=0,smoothDecimalPlaces:i}={}){const n=await getImgData(e),c=Math.ceil(128/a**2)+1,g={scale:t,ltres:c,qtres:c,colorquantcycles:a,numberofcolors:a},l=await svgo.optimize(toSvg(n,g));if(console.log({tolerance:r,smooth:s}),!r&&!s)return l;const m={combineLines:o,smooth:s,smoothDecimalPlaces:i,tolerance:r},u=dataOptimize(l.data,m);return{...l,data:u}}module.exports=svgThumbnailer;
