"use strict";const e=require("fs"),t=require("png.js"),i=require("jpeg-js"),r=require("imagetracerjs"),a=require("svgo"),{getPalette:o}=require("./color-thief"),s=require("./data-optimize"),n=new a({plugins:require("./svgo-plugins")}),c=r.imagedataToSVG;module.exports=async function(r,{colors:a=4,scale:l=1,vibrant:u=!0,tolerance:m=0,decimalPlaces:p=!0,smooth:h=0}={}){const g=await async function(r){const a=e.readFileSync(r);if(r.endsWith("png")){const e=new t(a),i=await new Promise((t,i)=>{e.parse((e,r)=>{e?i(e):t(r)})});return{height:i.height,width:i.width,data:i.pixels}}return i.decode(a)}(r),d=Math.ceil(128/a**2)+1,q={scale:l,ltres:d,qtres:d,pathomit:Math.min(32,4+3*a),colorquantcycles:Math.min(6,a),numberofcolors:a,mincolorratio:u?1e-5:.03};if(u){const{palette:e}=o(g,a);q.pal=e.map(([e,t,i])=>({r:e,g:t,b:i,a:255}))}const f=await n.optimize(c(g,q));if(!m&&p&&!h)return f;const w={smooth:h,decimalPlaces:p,tolerance:m};return n.optimize(s(f,w))};
