"use strict";const fs=require("fs"),PNGReader=require("png.js"),JPEGReader=require("jpeg-js"),ImageTracer=require("imagetracerjs"),SVGO=require("svgo"),{getPalette:getPalette}=require("./color-thief"),dataOptimize=require("./data-optimize"),svgo=new SVGO({plugins:require("./svgo-plugins")}),toSvg=ImageTracer.imagedataToSVG;async function getImgData(e){const t=fs.readFileSync(e);if(e.endsWith("png")){const e=new PNGReader(t),a=await new Promise((t,a)=>{e.parse((e,r)=>{e?a(e):t(r)})});return{height:a.height,width:a.width,data:a.pixels}}return JPEGReader.decode(t)}async function svgThumbnailer(e,{colors:t=4,scale:a=1,vibrant:r=!0,tolerance:i=0,decimalPlaces:o=!0,smooth:s=0}={}){const n=await getImgData(e),c=Math.ceil(128/t**2)+1,g={scale:a,ltres:c,qtres:c,pathomit:Math.min(32,4+3*t),colorquantcycles:Math.min(6,t),numberofcolors:t,mincolorratio:r?1e-5:.03};if(r){const{palette:e}=getPalette(n,t);g.pal=e.map(([e,t,a])=>({r:e,g:t,b:a,a:255}))}const l=await svgo.optimize(toSvg(n,g));if(!i&&o&&!s)return l;const m={smooth:s,decimalPlaces:o,tolerance:i};return svgo.optimize(dataOptimize(l,m))}module.exports=svgThumbnailer;
