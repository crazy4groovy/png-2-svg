"use strict";const fs=require("fs"),PNGReader=require("png.js"),JPEGReader=require("jpeg-js"),ImageTracer=require("imagetracerjs"),SVGO=require("svgo"),dataOptimize=require("./data-optimize"),svgo=new SVGO({plugins:require("./svgo-plugins")}),toSvg=ImageTracer.imagedataToSVG;async function getImgData(e){const a=fs.readFileSync(e);if(e.endsWith("png")){const e=new PNGReader(a),t=await new Promise((a,t)=>{e.parse((e,r)=>{e?t(e):a(r)})});return{height:t.height,width:t.width,data:t.pixels}}return JPEGReader.decode(a)}async function svgThumbnailer(e,{colors:a=4,scale:t=2,tolerance:r=0,combineLines:i=!1,smooth:o=0,smoothDecimalPlaces:s}={}){const n=await getImgData(e),c=Math.ceil(128/a**2)+1,m={scale:t,ltres:c,qtres:c,pathomit:4+3*a,colorquantcycles:2+a,numberofcolors:a,mincolorratio:.03},g=await svgo.optimize(toSvg(n,m));if(!(r||i||o))return g;const l={combineLines:i,smooth:o,smoothDecimalPlaces:s,tolerance:r},u=dataOptimize(g.data,l);return{...g,data:u}}module.exports=svgThumbnailer;
